(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{719:function(s,n,e){"use strict";e.r(n);var a=e(81),r=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"fabric学习"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fabric学习"}},[s._v("#")]),s._v(" fabric学习")]),s._v(" "),n("h2",{attrs:{id:"_0x00-to-begin-with"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0x00-to-begin-with"}},[s._v("#")]),s._v(" 0x00 To begin with")]),s._v(" "),n("p",[s._v("在前几天跑通了一个基于fabric的实例，总结一下在整个过程中学习到的知识。")]),s._v(" "),n("h2",{attrs:{id:"_0x01-区块链基础知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0x01-区块链基础知识"}},[s._v("#")]),s._v(" 0x01 区块链基础知识")]),s._v(" "),n("h3",{attrs:{id:"区块block"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#区块block"}},[s._v("#")]),s._v(" 区块block")]),s._v(" "),n("p",[n("code",[s._v("Block")]),s._v(" ，每个区块记录着上一个区块的 "),n("code",[s._v("hash")]),s._v(" 值、本区块中的交易集合、本区块的 "),n("code",[s._v("hash")]),s._v(" 等基础数据。由于每个区块都有上一区块的 "),n("code",[s._v("hash")]),s._v(" 值，区块间由这个值两两串联，形成了区块链。")]),s._v(" "),n("h3",{attrs:{id:"区块链blockchain"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#区块链blockchain"}},[s._v("#")]),s._v(" 区块链blockchain")]),s._v(" "),n("p",[s._v("区块链本质上就是一个多方共享的"),n("strong",[s._v("分布式账本")]),s._v("技术，用来记录网络上发生的所有交易。")]),s._v(" "),n("p",[s._v("而其中"),n("strong",[s._v("去中心化")]),s._v("的概念，是因为账本信息会被复制到许多网络参与者中，每个参与者都在"),n("strong",[s._v("协作")]),s._v("维护账本，不像传统应用的数据被中心管理着。")]),s._v(" "),n("p",[s._v("另外信息只能以附加的方式记录到账本上，并使用加密技术保证一旦将交易添加到账本就无法修改。这种"),n("strong",[s._v("不可修改")]),s._v("的属性简化了信息的溯源，因为参与者可以确定信息在记录后没有改变过。所以区块链有时也被称为"),n("strong",[s._v("证明系统")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#类型"}},[s._v("#")]),s._v(" 类型")]),s._v(" "),n("ul",[n("li",[s._v("完全去中心化：公链，人人都可以参与，就像比特币（挖矿相当于在记账）。主要采取工作量证明机制(POW)、权益证明机制(POS)、股份授权证明机制(DPOS)等方式。")]),s._v(" "),n("li",[s._v("部分去中心化：联盟链，参与者是指定的。联盟链可以是几家公司共同拥有的链，也可能是几个国家共同承认的链。这是后续发展的趋势。")]),s._v(" "),n("li",[s._v("中心化：私链，写入权限仅在一个组织手里的区块链，仅对特定的团队、组织或者个人开放。")])]),s._v(" "),n("h3",{attrs:{id:"智能合约smart-contract"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#智能合约smart-contract"}},[s._v("#")]),s._v(" 智能合约Smart contract")]),s._v(" "),n("p",[n("code",[s._v("Smart contract")]),s._v("，为了支持以同样的方式更新信息，并实现一整套账本功能（交易，查询等），区块链使用智能合约来提供对账本的受控访问。")]),s._v(" "),n("p",[s._v("智能合约不仅是在网络中封装和简化信息的关键机制，它还可以被编写成自动执行参与者的特定交易的合约。")]),s._v(" "),n("p",[s._v("例如，可以编写智能合约以规定运输物品的成本，其中运费根据物品到达的速度而变化。根据双方同意并写入账本的条款，当收到物品时，相应的资金会自动转手。")]),s._v(" "),n("p",[s._v("通俗易懂点，智能合约就是按照大家约定好的规则编写的业务逻辑代码实现，然后只能通过这些合约来操作区块链网络这个账本")]),s._v(" "),n("h2",{attrs:{id:"hyperledger-fabric相关知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hyperledger-fabric相关知识"}},[s._v("#")]),s._v(" Hyperledger Fabric相关知识")]),s._v(" "),n("h3",{attrs:{id:"整体介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#整体介绍"}},[s._v("#")]),s._v(" 整体介绍")]),s._v(" "),n("p",[s._v("Hyperledger Fabric 网络的成员只能从可信赖的成员服务提供者（MSP） 注册，因此fabric搭建的链是联盟链。")]),s._v(" "),n("p",[s._v("Hyperledger Fabric 的账本包括两个组件： 世界状态和交易日志。并且每个参与者都拥有他们所属的每个 Hyperledger Fabric 网络的账本的副本。")]),s._v(" "),n("ul",[n("li",[s._v("世界状态：描述了在给定时间点的账本的状态。它是账本的数据库。默认情况下，使用 LevelDB 键值存储数据库，可插拔，可替换为 CouchDB 。")]),s._v(" "),n("li",[s._v("交易日志：记录产生世界状态中当前值的所有交易。这是世界状态的更新历史。它只记录区块链网络使用账本数据库前后的值。")])]),s._v(" "),n("p",[s._v("总结：Hyperledger Fabric 是一种账本技术，其账本包括世界状态数据库和交易日志历史记录。")]),s._v(" "),n("h3",{attrs:{id:"联盟"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#联盟"}},[s._v("#")]),s._v(" 联盟")]),s._v(" "),n("p",[s._v("联盟指参与一个基于区块链的业务协作或业务交易网络的所有组织的集合，一个联盟一般包含多个组织。")]),s._v(" "),n("p",[s._v("一般由联盟发起方或运营方创建 "),n("code",[s._v("Orderer")]),s._v(" 排序节点，并负责交易排序、区块产生和达成共识。联盟发起方或运营方邀请各个组织实例加入联盟，进而创建通道。")]),s._v(" "),n("p",[s._v("组织代表的是参与区块链网络的企业、政府机构、团体等实体。")]),s._v(" "),n("p",[s._v("一个组织实例主要包含如下节点：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("CA")]),s._v(" ：区块链节点类型之一，全称 Certificate Authority ，数字证书颁发机构，负责组织内部成员的 "),n("code",[s._v("register")]),s._v(" 和 "),n("code",[s._v("enroll")]),s._v(" 等，为该组织的区块链用户生成和颁发数字证书。")]),s._v(" "),n("li",[n("code",[s._v("Peer")]),s._v(" ：区块链节点类型之一，负责保存和记录账本数据、对交易背书、运行智能合约等。")])]),s._v(" "),n("h3",{attrs:{id:"节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#节点"}},[s._v("#")]),s._v(" 节点")]),s._v(" "),n("p",[s._v("节点（Peers）是区块链的通信实体。它只是一个逻辑功能，只要能在“信任域”中分组并与控制它们的逻辑实体相关联，就可以将不同类型的多个节点运行在同一个物理服务器上，比如用 Docker 部署。")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("Orderer")]),s._v(" 排序服务节点 或 排序节点：Orderer 是一个运行实现交付担保的通信服务节点，例如原子性或总顺序广播。排序节点负责接受交易并排序（排序算法有: SOLO，KAFKA，RAFT，PBFT），最后将排序好的交易按照配置中的约定整理为区块之后提交给记账节点进行处理。")]),s._v(" "),n("li",[n("code",[s._v("Peer")]),s._v(" 节点：Peer 是业务参与方组织在区块链网络中所拥有的参与共识和账本记录的节点。可以有多种角色。作为 "),n("code",[s._v("Committing Peer")]),s._v(" 记账节点时，无需安装链码，只负责验证从 Orderer 发出的区块和交易的合法性、并存储账本区块信息。作为 "),n("code",[s._v("Endorsing Peer")]),s._v(" 背书节点时，必须安装链码，在交易时需进行签名背书。")]),s._v(" "),n("li",[n("code",[s._v("Anchor")]),s._v(" 锚节点：为了实现高可用，每个参与方组织一般包含两个或多个 "),n("code",[s._v("Peer")]),s._v(" 节点，可以设置其中的一个为 "),n("code",[s._v("Anchor")]),s._v(" ，与区块链网络中的其他组织进行信息同步。")]),s._v(" "),n("li",[s._v("客户端节点：客户端扮演了代表最终用户的实体，可以同时与 "),n("code",[s._v("Peer")]),s._v(" 和 "),n("code",[s._v("Orderer")]),s._v(" 通信，创建并调用交易。这里客户端可以指应用程序、SDK、命令行等。")])]),s._v(" "),n("h3",{attrs:{id:"通道"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通道"}},[s._v("#")]),s._v(" 通道")]),s._v(" "),n("p",[s._v("Hyperledger Fabric 中的通道（"),n("code",[s._v("Channel")]),s._v("）是两个或两个以上特定网络成员之间通信的专用“子网”，用于进行私有和机密的交易。")]),s._v(" "),n("p",[s._v("可以理解为组织间拉了个群聊，这个群聊就是通道，在里面聊天交易，一个联盟链中可以有多个群聊（通道），一个组织可以加入多个群聊，每个群聊可以代表一项具体的业务，有自身对应的一套账本，群聊间互不干扰，互相隔离。")]),s._v(" "),n("h3",{attrs:{id:"链码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#链码"}},[s._v("#")]),s._v(" 链码")]),s._v(" "),n("p",[s._v("Hyperledger Fabric 的智能合约用链码（"),n("code",[s._v("Chaincode")]),s._v("）编写。在大多数情况下，链码只与账本的数据库即世界状态交互，而不与交易日志交互。")]),s._v(" "),n("p",[s._v("链码可以用多种编程语言实现。有 Go、Node.js 和 Java 链码等。")]),s._v(" "),n("h3",{attrs:{id:"搭建区块链网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#搭建区块链网络"}},[s._v("#")]),s._v(" 搭建区块链网络")]),s._v(" "),n("p",[s._v("1、下载 fabric 二进制工具")]),s._v(" "),n("p",[s._v("以 "),n("code",[s._v("v1.4.12")]),s._v(" 版本为例， fabric 二进制工具的下载地址在："),n("strong",[s._v("https://github.com/hyperledger/fabric/releases/tag/v1.4.12")]),s._v("[3]")]),s._v(" "),n("p",[s._v("自行根据你的系统环境下载对应的包。")]),s._v(" "),n("p",[s._v("其中几个主要的工具说明：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("cryptogen")]),s._v(" ：用来生成 Hyperledger Fabric 密钥材料的工具，这个过程是静态的。"),n("code",[s._v("cryptogen")]),s._v(" 工具通过一个包含网络拓扑的 "),n("code",[s._v("crypto-config.yaml")]),s._v(" 文件，为所有组织和属于这些组织的组件生成一组证书和秘钥。"),n("code",[s._v("cryptogen")]),s._v(" 适合用于测试开发环境，在生产环境建议使用动态的 CA 服务。")]),s._v(" "),n("li",[n("code",[s._v("configtxgen")]),s._v(" ：用于创建和查看排序节点的创世区块、通道配置交易等相关的工具。"),n("code",[s._v("configtxgen")]),s._v(" 使用 "),n("code",[s._v("configtx.yaml")]),s._v(" 文件来定义网络配置。")]),s._v(" "),n("li",[n("code",[s._v("configtxlator")]),s._v("：fabric 中 "),n("code",[s._v("Protobuf")]),s._v(" 和 "),n("code",[s._v("JSON")]),s._v(" 格式转换的工具，fabric 中任何的使用 "),n("code",[s._v("Protobuf")]),s._v(" 定义的类型，都可使用该工具进行转换。")]),s._v(" "),n("li",[n("code",[s._v("peer")]),s._v("：peer 命令有 5 个不同的子命令，每个命令都可以让指定的 peer 节点执行特定的一组任务。比如，可以使用子命令 "),n("code",[s._v("peer channel")]),s._v(" 让一个 peer 节点加入通道，或者使用 "),n("code",[s._v("peer chaincode")]),s._v(" 命令把智能合约链码部署到 peer 节点上。")])]),s._v(" "),n("p",[s._v("2、将 fabric 二进制工具添加到环境变量")]),s._v(" "),n("p",[s._v("为了后续方便使用命令，可以将第 1 步下载的工具添加到系统环境变量中：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ export PATH=${PWD}/hyperledger-fabric-linux-amd64-1.4.12/bin:$PATH\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("3、生成证书和秘钥")]),s._v(" "),n("p",[s._v("我们将使用 "),n("code",[s._v("cryptogen")]),s._v(" 工具生成各种加密材料（ x509 证书和签名秘钥）。这些证书是身份的代表，在实体相互通信和交易的时候，可以对其身份进行签名和验证。")]),s._v(" "),n("p",[s._v("首先创建 "),n("code",[s._v("crypto-config.yaml")]),s._v(" 文件，定义网络拓扑，为所有组织和属于这些组织的组件（也就是节点）生成一组证书和秘钥，内容如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 排序节点的组织定义\nOrdererOrgs:\n  - Name: QQ # 名称\n    Domain: qq.com # 域名\n    Specs: # 节点域名：orderer.qq.com\n      - Hostname: orderer # 主机名\n\n# peer节点的组织定义\nPeerOrgs:\n  # Taobao-组织\n  - Name: Taobao # 名称\n    Domain: taobao.com # 域名\n    Template: # 使用模板定义。Count 指的是该组织下组织节点的个数\n      Count: 2 # 节点域名：peer0.taobao.com 和 peer1.taobao.com\n    Users: # 组织的用户信息。Count 指该组织中除了 Admin 之外的用户的个数\n      Count: 1 # 用户：Admin 和 User1\n\n  # JD-组织\n  - Name: JD\n    Domain: jd.com\n    Template:\n      Count: 2 # 节点域名：peer0.jd.com 和 peer1.jd.com\n    Users:\n      Count: 1 # 用户：Admin 和 User1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("接着执行 "),n("code",[s._v("cryptogen generate")]),s._v(" 命令，生成结果将默认保存在 "),n("code",[s._v("crypto-config")]),s._v(" 文件夹中：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cryptogen generate --config=./crypto-config.yaml\ntaobao.com\njd.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("我们可以看看在 "),n("code",[s._v("crypto-config")]),s._v(" 文件夹里生成了什么：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ tree crypto-config\ncrypto-config\n├── ordererOrganizations\n│   └── qq.com\n│       ├── ca\n│       │   ├── 3e41f960bb5a3002a1e436e9079311d79cf8846c2ad2a09080ea8575e16bb5b7_sk\n│       │   └── ca.qq.com-cert.pem\n│       ├── msp\n│       │   ├── admincerts\n│       │   │   └── Admin@qq.com-cert.pem\n│       │   ├── cacerts\n│       │   │   └── ca.qq.com-cert.pem\n│       │   └── tlscacerts\n│       │       └── tlsca.qq.com-cert.pem\n│       ├── orderers\n│       │   └── orderer.qq.com\n│       │       ├── msp\n│       │       │   ├── admincerts\n│       │       │   │   └── Admin@qq.com-cert.pem\n│       │       │   ├── cacerts\n│       │       │   │   └── ca.qq.com-cert.pem\n│       │       │   ├── keystore\n│       │       │   │   └── 6bd45f78877b96cfbcd040262ee4c808bd6d894cabfed44552fb7c22d6d427d1_sk\n│       │       │   ├── signcerts\n│       │       │   │   └── orderer.qq.com-cert.pem\n│       │       │   └── tlscacerts\n│       │       │       └── tlsca.qq.com-cert.pem\n│       │       └── tls\n│       │           ├── ca.crt\n│       │           ├── server.crt\n│       │           └── server.key\n│       ├── tlsca\n│       │   ├── bd48b5360c82ce5beeb31dea1b7e8e7918a5e7246d3f8892889fe1b2efadc1aa_sk\n│       │   └── tlsca.qq.com-cert.pem\n│       └── users\n│           └── Admin@qq.com\n│               ├── msp\n│               │   ├── admincerts\n│               │   │   └── Admin@qq.com-cert.pem\n│               │   ├── cacerts\n│               │   │   └── ca.qq.com-cert.pem\n│               │   ├── keystore\n│               │   │   └── f28c1ed4c67fd438a891e420a2e53b20352bdf40907a0a8ee39095505475c99f_sk\n│               │   ├── signcerts\n│               │   │   └── Admin@qq.com-cert.pem\n│               │   └── tlscacerts\n│               │       └── tlsca.qq.com-cert.pem\n│               └── tls\n│                   ├── ca.crt\n│                   ├── client.crt\n│                   └── client.key\n└── peerOrganizations\n    ├── jd.com\n    │   ├── ca\n    │   │   ├── 5672a9717fd943d0dcd2269ea1700c10309ad49d16b849e9c6e24225deafceb5_sk\n    │   │   └── ca.jd.com-cert.pem\n    │   ├── msp\n    │   │   ├── admincerts\n    │   │   │   └── Admin@jd.com-cert.pem\n    │   │   ├── cacerts\n    │   │   │   └── ca.jd.com-cert.pem\n    │   │   └── tlscacerts\n    │   │       └── tlsca.jd.com-cert.pem\n    │   ├── peers\n    │   │   ├── peer0.jd.com\n    │   │   │   ├── msp\n    │   │   │   │   ├── admincerts\n    │   │   │   │   │   └── Admin@jd.com-cert.pem\n    │   │   │   │   ├── cacerts\n    │   │   │   │   │   └── ca.jd.com-cert.pem\n    │   │   │   │   ├── keystore\n    │   │   │   │   │   └── 012700eb44d6e19becb63c944e685a18d69ea9f1120aaa45fe549236c6a90fb6_sk\n    │   │   │   │   ├── signcerts\n    │   │   │   │   │   └── peer0.jd.com-cert.pem\n    │   │   │   │   └── tlscacerts\n    │   │   │   │       └── tlsca.jd.com-cert.pem\n    │   │   │   └── tls\n    │   │   │       ├── ca.crt\n    │   │   │       ├── server.crt\n    │   │   │       └── server.key\n    │   │   └── peer1.jd.com\n    │   │       ├── msp\n    │   │       │   ├── admincerts\n    │   │       │   │   └── Admin@jd.com-cert.pem\n    │   │       │   ├── cacerts\n    │   │       │   │   └── ca.jd.com-cert.pem\n    │   │       │   ├── keystore\n    │   │       │   │   └── b1e81b66080705595f5e56cc8d78575b0e935b79c8f674001e46cae452a71f32_sk\n    │   │       │   ├── signcerts\n    │   │       │   │   └── peer1.jd.com-cert.pem\n    │   │       │   └── tlscacerts\n    │   │       │       └── tlsca.jd.com-cert.pem\n    │   │       └── tls\n    │   │           ├── ca.crt\n    │   │           ├── server.crt\n    │   │           └── server.key\n    │   ├── tlsca\n    │   │   ├── f4c7d0b660575f383d189696480bf559f312d798eb0352c9102f8be6ecde52d6_sk\n    │   │   └── tlsca.jd.com-cert.pem\n    │   └── users\n    │       ├── Admin@jd.com\n    │       │   ├── msp\n    │       │   │   ├── admincerts\n    │       │   │   │   └── Admin@jd.com-cert.pem\n    │       │   │   ├── cacerts\n    │       │   │   │   └── ca.jd.com-cert.pem\n    │       │   │   ├── keystore\n    │       │   │   │   └── d7f476884ff36a19aa7100c63aa30f8f378cc5ec826ca58977539e1c9c6b22df_sk\n    │       │   │   ├── signcerts\n    │       │   │   │   └── Admin@jd.com-cert.pem\n    │       │   │   └── tlscacerts\n    │       │   │       └── tlsca.jd.com-cert.pem\n    │       │   └── tls\n    │       │       ├── ca.crt\n    │       │       ├── client.crt\n    │       │       └── client.key\n    │       └── User1@jd.com\n    │           ├── msp\n    │           │   ├── admincerts\n    │           │   │   └── User1@jd.com-cert.pem\n    │           │   ├── cacerts\n    │           │   │   └── ca.jd.com-cert.pem\n    │           │   ├── keystore\n    │           │   │   └── e83862c8e78509f2a4362d3282214421179fa47f3d655f75cb3539d5534f7494_sk\n    │           │   ├── signcerts\n    │           │   │   └── User1@jd.com-cert.pem\n    │           │   └── tlscacerts\n    │           │       └── tlsca.jd.com-cert.pem\n    │           └── tls\n    │               ├── ca.crt\n    │               ├── client.crt\n    │               └── client.key\n    └── taobao.com\n        ├── ca\n        │   ├── 4a31791b9fade54ab70496f03169707f6b9643c04d1bc734da15b0c625628865_sk\n        │   └── ca.taobao.com-cert.pem\n        ├── msp\n        │   ├── admincerts\n        │   │   └── Admin@taobao.com-cert.pem\n        │   ├── cacerts\n        │   │   └── ca.taobao.com-cert.pem\n        │   └── tlscacerts\n        │       └── tlsca.taobao.com-cert.pem\n        ├── peers\n        │   ├── peer0.taobao.com\n        │   │   ├── msp\n        │   │   │   ├── admincerts\n        │   │   │   │   └── Admin@taobao.com-cert.pem\n        │   │   │   ├── cacerts\n        │   │   │   │   └── ca.taobao.com-cert.pem\n        │   │   │   ├── keystore\n        │   │   │   │   └── 914648b8c4dc4783b0505a22b5c7630e424c3cf8dd54e2fe05b47dc321a4e61b_sk\n        │   │   │   ├── signcerts\n        │   │   │   │   └── peer0.taobao.com-cert.pem\n        │   │   │   └── tlscacerts\n        │   │   │       └── tlsca.taobao.com-cert.pem\n        │   │   └── tls\n        │   │       ├── ca.crt\n        │   │       ├── server.crt\n        │   │       └── server.key\n        │   └── peer1.taobao.com\n        │       ├── msp\n        │       │   ├── admincerts\n        │       │   │   └── Admin@taobao.com-cert.pem\n        │       │   ├── cacerts\n        │       │   │   └── ca.taobao.com-cert.pem\n        │       │   ├── keystore\n        │       │   │   └── 3eef8defc07afb547e94f08702a5b30807d2e2a672e3d437bfb54dd1590b0fa7_sk\n        │       │   ├── signcerts\n        │       │   │   └── peer1.taobao.com-cert.pem\n        │       │   └── tlscacerts\n        │       │       └── tlsca.taobao.com-cert.pem\n        │       └── tls\n        │           ├── ca.crt\n        │           ├── server.crt\n        │           └── server.key\n        ├── tlsca\n        │   ├── 296a941f625974153aa5ab6cf57b0933023aaa13b0e4363a7378e5c527de26a1_sk\n        │   └── tlsca.taobao.com-cert.pem\n        └── users\n            ├── Admin@taobao.com\n            │   ├── msp\n            │   │   ├── admincerts\n            │   │   │   └── Admin@taobao.com-cert.pem\n            │   │   ├── cacerts\n            │   │   │   └── ca.taobao.com-cert.pem\n            │   │   ├── keystore\n            │   │   │   └── a2af975d659f77182b2aca318321797d281036f085dda9799ab79b6400e5e970_sk\n            │   │   ├── signcerts\n            │   │   │   └── Admin@taobao.com-cert.pem\n            │   │   └── tlscacerts\n            │   │       └── tlsca.taobao.com-cert.pem\n            │   └── tls\n            │       ├── ca.crt\n            │       ├── client.crt\n            │       └── client.key\n            └── User1@taobao.com\n                ├── msp\n                │   ├── admincerts\n                │   │   └── User1@taobao.com-cert.pem\n                │   ├── cacerts\n                │   │   └── ca.taobao.com-cert.pem\n                │   ├── keystore\n                │   │   └── c65d45e1c7e1070e3f1b00bd8ac41e91d2bfaea10a769d75b9599590791ccc02_sk\n                │   ├── signcerts\n                │   │   └── User1@taobao.com-cert.pem\n                │   └── tlscacerts\n                │       └── tlsca.taobao.com-cert.pem\n                └── tls\n                    ├── ca.crt\n                    ├── client.crt\n                    └── client.key\n\n109 directories, 101 files\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br"),n("span",{staticClass:"line-number"},[s._v("188")]),n("br"),n("span",{staticClass:"line-number"},[s._v("189")]),n("br"),n("span",{staticClass:"line-number"},[s._v("190")]),n("br"),n("span",{staticClass:"line-number"},[s._v("191")]),n("br"),n("span",{staticClass:"line-number"},[s._v("192")]),n("br"),n("span",{staticClass:"line-number"},[s._v("193")]),n("br"),n("span",{staticClass:"line-number"},[s._v("194")]),n("br"),n("span",{staticClass:"line-number"},[s._v("195")]),n("br"),n("span",{staticClass:"line-number"},[s._v("196")]),n("br"),n("span",{staticClass:"line-number"},[s._v("197")]),n("br"),n("span",{staticClass:"line-number"},[s._v("198")]),n("br"),n("span",{staticClass:"line-number"},[s._v("199")]),n("br"),n("span",{staticClass:"line-number"},[s._v("200")]),n("br"),n("span",{staticClass:"line-number"},[s._v("201")]),n("br"),n("span",{staticClass:"line-number"},[s._v("202")]),n("br"),n("span",{staticClass:"line-number"},[s._v("203")]),n("br"),n("span",{staticClass:"line-number"},[s._v("204")]),n("br"),n("span",{staticClass:"line-number"},[s._v("205")]),n("br"),n("span",{staticClass:"line-number"},[s._v("206")]),n("br"),n("span",{staticClass:"line-number"},[s._v("207")]),n("br"),n("span",{staticClass:"line-number"},[s._v("208")]),n("br"),n("span",{staticClass:"line-number"},[s._v("209")]),n("br"),n("span",{staticClass:"line-number"},[s._v("210")]),n("br"),n("span",{staticClass:"line-number"},[s._v("211")]),n("br"),n("span",{staticClass:"line-number"},[s._v("212")]),n("br"),n("span",{staticClass:"line-number"},[s._v("213")]),n("br"),n("span",{staticClass:"line-number"},[s._v("214")]),n("br")])]),n("p",[s._v("总结：在这个环节中，我们假设 "),n("code",[s._v("QQ")]),s._v(" 作为一个运营方，提供了 1 个 Orderer 节点 "),n("code",[s._v("orderer.qq.com")]),s._v(" 来创建联盟链的基础设施， 而 "),n("code",[s._v("Taobao")]),s._v(" 和 "),n("code",[s._v("JD")]),s._v(" 则是作为组织成员加入到链中，各自提供 2 个 Peer 节点 "),n("code",[s._v("peer0.xx.com")]),s._v(" 和 "),n("code",[s._v("peer1.xx.com")]),s._v(" 参与工作，以及还各自创建了 2 个组织用户 "),n("code",[s._v("Admin")]),s._v(" 和 "),n("code",[s._v("User1")]),s._v(" 。然后我们使用 "),n("code",[s._v("crypto-config.yaml")]),s._v(" 文件和 "),n("code",[s._v("cryptogen")]),s._v(" 工具为其定义所需要的证书文件以供后续使用。")]),s._v(" "),n("p",[s._v("4、创建排序通道创世区块")]),s._v(" "),n("p",[s._v("我们可以使用 "),n("code",[s._v("configtx.yaml")]),s._v(" 文件和 "),n("code",[s._v("configtxgen")]),s._v(" 工具轻松地创建通道的配置。"),n("code",[s._v("configtx.yaml")]),s._v(" 文件可以以易于理解和编辑的 "),n("code",[s._v("yaml")]),s._v(" 格式来构建通道配置所需的信息。"),n("code",[s._v("configtxgen")]),s._v(" 工具通过读取 "),n("code",[s._v("configtx.yaml")]),s._v(" 文件中的信息，将其转成 Fabric 可以读取的 "),n("code",[s._v("protobuf")]),s._v(" 格式。")]),s._v(" "),n("p",[s._v("先来创建 "),n("code",[s._v("configtx.yaml")]),s._v(" 文件，内容如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 定义组织机构实体\nOrganizations:\n  - &QQ\n    Name: QQ # 组织的名称\n    ID: QQMSP # 组织的 MSPID\n    MSPDir: crypto-config/ordererOrganizations/qq.com/msp #组织的证书相对位置（生成的crypto-config目录)\n\n  - &Taobao\n    Name: Taobao\n    ID: TaobaoMSP\n    MSPDir: crypto-config/peerOrganizations/taobao.com/msp\n    AnchorPeers: # 组织锚节点的配置\n      - Host: peer0.taobao.com\n        Port: 7051\n\n  - &JD\n    Name: JD\n    ID: JDMSP\n    MSPDir: crypto-config/peerOrganizations/jd.com/msp\n    AnchorPeers: # 组织锚节点的配置\n      - Host: peer0.jd.com\n        Port: 7051\n\n# 定义了排序服务的相关参数，这些参数将用于创建创世区块\nOrderer: &OrdererDefaults\n  # 排序节点类型用来指定要启用的排序节点实现，不同的实现对应不同的共识算法\n  OrdererType: solo # 共识机制\n  Addresses: # Orderer 的域名（用于连接）\n    - orderer.qq.com:7050\n  BatchTimeout: 2s # 出块时间间隔\n  BatchSize: # 用于控制每个block的信息量\n    MaxMessageCount: 10 #每个区块的消息个数\n    AbsoluteMaxBytes: 99 MB #每个区块最大的信息大小\n    PreferredMaxBytes: 512 KB #每个区块包含的一条信息最大长度\n  Organizations:\n\n# 定义Peer组织如何与应用程序通道交互的策略\n# 默认策略：所有Peer组织都将能够读取数据并将数据写入账本\nApplication: &ApplicationDefaults\n  Organizations:\n\n# 用来定义用于 configtxgen 工具的配置入口\n# 将 Profile 参数（ TwoOrgsOrdererGenesis 或 TwoOrgsChannel ）指定为 configtxgen 工具的参数\nProfiles:\n  #  TwoOrgsOrdererGenesis配置文件用于创建系统通道创世块\n  #  该配置文件创建一个名为SampleConsortium的联盟\n  #  该联盟在configtx.yaml文件中包含两个Peer组织Taobao和JD\n  TwoOrgsOrdererGenesis:\n    Orderer:\n      <<: *OrdererDefaults\n      Organizations:\n        - *QQ\n    Consortiums:\n      SampleConsortium:\n        Organizations:\n          - *Taobao\n          - *JD\n  # 使用TwoOrgsChannel配置文件创建应用程序通道\n  TwoOrgsChannel:\n    Consortium: SampleConsortium\n    Application:\n      <<: *ApplicationDefaults\n      Organizations:\n        - *Taobao\n        - *JD\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br")])]),n("p",[s._v("执行 "),n("code",[s._v("configtxgen")]),s._v(" 命令，并指定 Profile 为 "),n("code",[s._v("TwoOrgsOrdererGenesis")]),s._v(" 参数：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./config/genesis.block -channelID firstchannel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("排序区块是排序服务的创世区块，通过以上命令就可以预先生成创世区块的 "),n("code",[s._v("protobuf")]),s._v(" 格式的配置文件 "),n("code",[s._v("./config/genesis.block")]),s._v(" 了。这一步也是为后续做准备用的。")]),s._v(" "),n("p",[s._v("5、创建通道配置交易")]),s._v(" "),n("p",[s._v("接下来，我们需要继续使用 "),n("code",[s._v("configtxgen")]),s._v(" 根据去创建通道的交易配置，和第 4 步不同的是，这次需要指定 Profile 为 "),n("code",[s._v("TwoOrgsChannel")]),s._v(" 参数。")]),s._v(" "),n("p",[s._v("生成通道配置事务 "),n("code",[s._v("./config/appchannel.tx")]),s._v(" ：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./config/appchannel.tx -channelID appchannel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("为 "),n("code",[s._v("Taobao")]),s._v(" 组织定义锚节点，生成 "),n("code",[s._v("./config/TaobaoAnchor.tx")]),s._v(" ：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./config/TaobaoAnchor.tx -channelID appchannel -asOrg Taobao\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("为 "),n("code",[s._v("JD")]),s._v(" 组织定义锚节点，生成 "),n("code",[s._v("./config/JDAnchor.tx")]),s._v(" ：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./config/JDAnchor.tx -channelID appchannel -asOrg JD\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("当然，这一步也是为后续使用做准备的。不过至此，需要准备的配置都齐了。")]),s._v(" "),n("p",[s._v("来看看现在 "),n("code",[s._v("config")]),s._v(" 文件夹都有什么：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ tree config\nconfig\n├── JDAnchor.tx\n├── TaobaoAnchor.tx\n├── appchannel.tx\n└── genesis.block\n\n0 directories, 4 files\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("6、创建并启动各组织的节点")]),s._v(" "),n("p",[s._v("我们说过：我们假设 "),n("code",[s._v("QQ")]),s._v(" 作为一个运营方，提供了 1 个 Orderer 节点 "),n("code",[s._v("orderer.qq.com")]),s._v(" 来创建联盟链的基础设施， 而 "),n("code",[s._v("Taobao")]),s._v(" 和 "),n("code",[s._v("JD")]),s._v(" 则是作为组织成员加入到链中，各自提供 2 个 Peer 节点 "),n("code",[s._v("peer0.xx.com")]),s._v(" 和 "),n("code",[s._v("peer1.xx.com")]),s._v(" 参与工作。")]),s._v(" "),n("p",[s._v("现在这些组织及其节点所需要的配置已经准备好了。我们接下来就可以使用 Docker Compose 来模拟启动这些节点服务。")]),s._v(" "),n("p",[s._v("由于这些节点之间需要互相通信，所以我们需要将这些节点都放入到一个 Docker 网络中，以 "),n("code",[s._v("fabric_network")]),s._v(" 为例。")]),s._v(" "),n("p",[n("code",[s._v("docker-compose.yaml")]),s._v(" 的内容如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('version: \'2.1\'\n\nvolumes:\n  orderer.qq.com:\n  peer0.taobao.com:\n  peer1.taobao.com:\n  peer0.jd.com:\n  peer1.jd.com:\n\nnetworks:\n  fabric_network:\n    name: fabric_network\n\nservices:\n  # 排序服务节点\n  orderer.qq.com:\n    container_name: orderer.qq.com\n    image: hyperledger/fabric-orderer:1.4.12\n    environment:\n      - GODEBUG=netdns=go\n      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0\n      - ORDERER_GENERAL_GENESISMETHOD=file\n      - ORDERER_GENERAL_GENESISFILE=/etc/hyperledger/config/genesis.block # 注入创世区块\n      - ORDERER_GENERAL_LOCALMSPID=QQMSP\n      - ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/orderer/msp # 证书相关\n    command: orderer\n    ports:\n      - "7050:7050"\n    volumes: # 挂载由cryptogen和configtxgen生成的证书文件以及创世区块\n      - ./config/genesis.block:/etc/hyperledger/config/genesis.block\n      - ./crypto-config/ordererOrganizations/qq.com/orderers/orderer.qq.com/:/etc/hyperledger/orderer\n      - orderer.qq.com:/var/hyperledger/production/orderer\n    networks:\n      - fabric_network\n\n  #  Taobao 组织 peer0 节点\n  peer0.taobao.com:\n    extends:\n      file: docker-compose-base.yaml\n      service: peer-base\n    container_name: peer0.taobao.com\n    environment:\n      - CORE_PEER_ID=peer0.taobao.com\n      - CORE_PEER_LOCALMSPID=TaobaoMSP\n      - CORE_PEER_ADDRESS=peer0.taobao.com:7051\n    ports:\n      - "7051:7051" # grpc服务端口\n      - "7053:7053" # eventhub端口\n    volumes:\n      - ./crypto-config/peerOrganizations/taobao.com/peers/peer0.taobao.com:/etc/hyperledger/peer\n      - peer0.taobao.com:/var/hyperledger/production\n    depends_on:\n      - orderer.qq.com\n\n  #  Taobao 组织 peer1 节点\n  peer1.taobao.com:\n    extends:\n      file: docker-compose-base.yaml\n      service: peer-base\n    container_name: peer1.taobao.com\n    environment:\n      - CORE_PEER_ID=peer1.taobao.com\n      - CORE_PEER_LOCALMSPID=TaobaoMSP\n      - CORE_PEER_ADDRESS=peer1.taobao.com:7051\n    ports:\n      - "17051:7051"\n      - "17053:7053"\n    volumes:\n      - ./crypto-config/peerOrganizations/taobao.com/peers/peer1.taobao.com:/etc/hyperledger/peer\n      - peer1.taobao.com:/var/hyperledger/production\n    depends_on:\n      - orderer.qq.com\n\n  #  JD 组织 peer0 节点\n  peer0.jd.com:\n    extends:\n      file: docker-compose-base.yaml\n      service: peer-base\n    container_name: peer0.jd.com\n    environment:\n      - CORE_PEER_ID=peer0.jd.com\n      - CORE_PEER_LOCALMSPID=JDMSP\n      - CORE_PEER_ADDRESS=peer0.jd.com:7051\n    ports:\n      - "27051:7051"\n      - "27053:7053"\n    volumes:\n      - ./crypto-config/peerOrganizations/jd.com/peers/peer0.jd.com:/etc/hyperledger/peer\n      - peer0.jd.com:/var/hyperledger/production\n    depends_on:\n      - orderer.qq.com\n\n  #  JD 组织 peer1 节点\n  peer1.jd.com:\n    extends:\n      file: docker-compose-base.yaml\n      service: peer-base\n    container_name: peer1.jd.com\n    environment:\n      - CORE_PEER_ID=peer1.jd.com\n      - CORE_PEER_LOCALMSPID=JDMSP\n      - CORE_PEER_ADDRESS=peer1.jd.com:7051\n    ports:\n      - "37051:7051"\n      - "37053:7053"\n    volumes:\n      - ./crypto-config/peerOrganizations/jd.com/peers/peer1.jd.com:/etc/hyperledger/peer\n      - peer1.jd.com:/var/hyperledger/production\n    depends_on:\n      - orderer.qq.com\n\n  # 客户端节点\n  cli:\n    container_name: cli\n    image: hyperledger/fabric-tools:1.4.12\n    tty: true\n    environment:\n      # go 环境设置\n      - GO111MODULE=auto\n      - GOPROXY=https://goproxy.cn\n      - CORE_PEER_ID=cli\n    command: /bin/bash\n    volumes:\n      - ./config:/etc/hyperledger/config\n      - ./crypto-config/peerOrganizations/taobao.com/:/etc/hyperledger/peer/taobao.com\n      - ./crypto-config/peerOrganizations/jd.com/:/etc/hyperledger/peer/jd.com\n      - ./../chaincode:/opt/gopath/src/chaincode # 链码路径注入\n    networks:\n      - fabric_network\n    depends_on:\n      - orderer.qq.com\n      - peer0.taobao.com\n      - peer1.taobao.com\n      - peer0.jd.com\n      - peer1.jd.com\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br")])]),n("p",[s._v("为了方便，这里我还定义了一个 "),n("code",[s._v("docker-compose-base.yaml")]),s._v(" 作为 Peer 节点的公共模板，内容如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '2.1'\n\nservices:\n  peer-base: # peer的公共服务\n    image: hyperledger/fabric-peer:1.4.12\n    environment:\n      - GODEBUG=netdns=go\n      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock\n      - CORE_LOGGING_PEER=info\n      - CORE_CHAINCODE_LOGGING_LEVEL=INFO\n      - CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/peer/msp # msp证书（节点证书）\n      - CORE_LEDGER_STATE_STATEDATABASE=goleveldb # 状态数据库的存储引擎（or CouchDB）\n      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=fabric_network # docker 网络\n    volumes:\n      - /var/run/docker.sock:/host/var/run/docker.sock\n    working_dir: /opt/gopath/src/github.com/hyperledger/fabric\n    command: peer node start\n    networks:\n      - fabric_network\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("注意观察，在 "),n("code",[s._v("volumes")]),s._v(" 配置项中，我们将 "),n("code",[s._v("config")]),s._v(" 和 "),n("code",[s._v("crypto-config")]),s._v(" 内的配置文件都挂载到相对应的节点中了。并且在 peer 的公共服务中，我们还挂载了 "),n("code",[s._v("/var/run/docker.sock")]),s._v(" 文件，有了该文件，在容器内就可以向其发送 http 请求和 Docker Daemon 通信，通俗理解，就是有了它，就可以在容器内操作宿主机的 Docker 了，比如在容器内控制 Docker 再启动一个容器出来。而这，就是为了后面可以部署智能合约（节点部署链码其实就是启动一个链码容器）。")]),s._v(" "),n("p",[s._v("现在继续将这些节点服务启动起来：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker-compose up -d\nCreating network "fabric_network" with the default driver\nCreating volume "network_orderer.qq.com" with default driver\nCreating volume "network_peer0.taobao.com" with default driver\nCreating volume "network_peer1.taobao.com" with default driver\nCreating volume "network_peer0.jd.com" with default driver\nCreating volume "network_peer1.jd.com" with default driver\nCreating orderer.qq.com ... done\nCreating peer1.taobao.com ... done\nCreating peer0.jd.com     ... done\nCreating peer1.jd.com     ... done\nCreating peer0.taobao.com ... done\nCreating cli              ... done\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("哦对了，除了必须的节点服务，我还启动了一个 "),n("code",[s._v("cli")]),s._v(" 服务，来自 "),n("code",[s._v("hyperledger/fabric-tools")]),s._v(" 镜像，这个其实就是集成了前面第 1 步提到的 fabric 工具的容器，我们接下来的命令执行就使用这个容器内的工具来完成了，你也可以继续使用自己下载的二进制工具，只是个人觉得环境配置起来会比较麻烦。")]),s._v(" "),n("p",[s._v("7、为 "),n("code",[s._v("cli")]),s._v(" 服务配置环境")]),s._v(" "),n("p",[s._v("接下来我们要使用 "),n("code",[s._v("cli")]),s._v(" 服务来执行 "),n("code",[s._v("peer")]),s._v(" 命令，所以要为其先配置一下环境变量，使用四个不同的变量 "),n("code",[s._v("TaobaoPeer0Cli")]),s._v("、"),n("code",[s._v("TaobaoPeer1Cli")]),s._v("、"),n("code",[s._v("JDPeer0Cli")]),s._v("、"),n("code",[s._v("JDPeer1Cli")]),s._v(" ，代表 "),n("code",[s._v("cli")]),s._v(" 服务代表着不同的节点：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ TaobaoPeer0Cli="CORE_PEER_ADDRESS=peer0.taobao.com:7051 CORE_PEER_LOCALMSPID=TaobaoMSP CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/peer/taobao.com/users/Admin@taobao.com/msp"\n$ TaobaoPeer1Cli="CORE_PEER_ADDRESS=peer1.taobao.com:7051 CORE_PEER_LOCALMSPID=TaobaoMSP CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/peer/taobao.com/users/Admin@taobao.com/msp"\n$ JDPeer0Cli="CORE_PEER_ADDRESS=peer0.jd.com:7051 CORE_PEER_LOCALMSPID=JDMSP CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/peer/jd.com/users/Admin@jd.com/msp"\n$ JDPeer1Cli="CORE_PEER_ADDRESS=peer1.jd.com:7051 CORE_PEER_LOCALMSPID=JDMSP CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/peer/jd.com/users/Admin@jd.com/msp"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("8、开始创建通道")]),s._v(" "),n("p",[s._v("通道主要用于实现区块链网络中业务的隔离。一个联盟中可以有多个通道，每个通道可代表一项业务，并且对应一套账本。通道内的成员为业务参与方（即联盟内的组织），一个组织可以加入多个通道。")]),s._v(" "),n("p",[s._v("我们现在有请 "),n("code",[s._v("Taobao")]),s._v(" 组织的 "),n("code",[s._v("peer0")]),s._v(" 节点来创建一个通道 "),n("code",[s._v("appchannel")]),s._v(" ：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker exec cli bash -c "$TaobaoPeer0Cli peer channel create -o orderer.qq.com:7050 -c appchannel -f /etc/hyperledger/config/appchannel.tx"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("通道就相当于“群聊”， "),n("code",[s._v("Taobao")]),s._v(" 组织的 "),n("code",[s._v("peer0")]),s._v(" 节点创建了一个名称为 "),n("code",[s._v("appchannel")]),s._v(" 的“群聊”。")]),s._v(" "),n("p",[s._v("9、将所有节点加入通道")]),s._v(" "),n("p",[s._v("将所有的节点都加入到通道 "),n("code",[s._v("appchannel")]),s._v(" 中（正常是按需加入）：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker exec cli bash -c "$TaobaoPeer0Cli peer channel join -b appchannel.block"\n$ docker exec cli bash -c "$TaobaoPeer1Cli peer channel join -b appchannel.block"\n$ docker exec cli bash -c "$JDPeer0Cli peer channel join -b appchannel.block"\n$ docker exec cli bash -c "$JDPeer1Cli peer channel join -b appchannel.block"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("这时相当于大家都加入到了 "),n("code",[s._v("appchannel")]),s._v(" “群聊”中，之后大家都可以在里面“聊天”了。")]),s._v(" "),n("p",[s._v("10、更新锚节点")]),s._v(" "),n("p",[s._v("锚节点是必需的。普通节点只能发现本组织下的其它节点，而锚节点可以跨组织服务发现到其它组织下的节点，建议每个组织都选择至少一个锚节点。")]),s._v(" "),n("p",[s._v("利用之前准备好的配置文件，向通道更新锚节点：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker exec cli bash -c "$TaobaoPeer0Cli peer channel update -o orderer.qq.com:7050 -c appchannel -f /etc/hyperledger/config/TaobaoAnchor.tx"\n$ docker exec cli bash -c "$JDPeer0Cli peer channel update -o orderer.qq.com:7050 -c appchannel -f /etc/hyperledger/config/JDAnchor.tx"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这样，"),n("code",[s._v("Taobao")]),s._v(" 和 "),n("code",[s._v("JD")]),s._v(" 组织间的节点就都可以互相发现了。")]),s._v(" "),n("p",[s._v("到这里，我们的区块链网络基本已经搭建好了，但是还差最关键的智能合约。一个没有智能合约的通道是没有灵魂的，啥事都做不了。")]),s._v(" "),n("h3",{attrs:{id:"编写智能合约"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编写智能合约"}},[s._v("#")]),s._v(" 编写智能合约")]),s._v(" "),n("p",[s._v("fabric 的智能合约称为链码，编写智能合约也就是编写链码。")]),s._v(" "),n("p",[s._v("链码其实很简单，可以由 Go 、 node.js 、或者 Java 编写，其实只是实现一些预定义的接口。")]),s._v(" "),n("p",[s._v("以 Go 为例，创建一个 "),n("code",[s._v("main.go")]),s._v(" 文件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package main\n\nimport (\n "fmt"\n\n "github.com/hyperledger/fabric/core/chaincode/shim"\n pb "github.com/hyperledger/fabric/protos/peer"\n)\n\ntype MyChaincode struct {\n}\n\n// Init 初始化时会执行该方法\nfunc (c *MyChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response {\n fmt.Println("链码初始化")\n return shim.Success(nil)\n}\n\n// Invoke 智能合约的功能函数定义\nfunc (c *MyChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response {\n funcName, args := stub.GetFunctionAndParameters()\n switch funcName {\n\n default:\n  return shim.Error(fmt.Sprintf("没有该功能: %s", funcName))\n }\n}\n\nfunc main() {\n err := shim.Start(new(MyChaincode))\n if err != nil {\n  panic(err)\n }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("p",[s._v("我们定义的 "),n("code",[s._v("MyChaincode")]),s._v(" 结构体实现了 "),n("code",[s._v("shim.Chaincode")]),s._v(" 接口：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// Chaincode interface must be implemented by all chaincodes. The fabric runs\n// the transactions by calling these functions as specified.\ntype Chaincode interface {\n // Init is called during Instantiate transaction after the chaincode container\n // has been established for the first time, allowing the chaincode to\n // initialize its internal data\n Init(stub ChaincodeStubInterface) pb.Response\n\n // Invoke is called to update or query the ledger in a proposal transaction.\n // Updated state variables are not committed to the ledger until the\n // transaction is committed.\n Invoke(stub ChaincodeStubInterface) pb.Response\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("然后在启动入口 "),n("code",[s._v("main")]),s._v(" 函数中调用 "),n("code",[s._v("shim.Start(new(MyChaincode))")]),s._v(" 就完成了链码的启动，没错，就是这么简单。")]),s._v(" "),n("p",[s._v("我们知道链码其实就是用来处理区块链网络中的成员一致同意的业务逻辑。比如 "),n("code",[s._v("Taobao")]),s._v(" 和 "),n("code",[s._v("JD")]),s._v(" 规定了一个规则，将其编写成链码，后面双方就只能遵循这个规则了，因为链码到时候即部署在你的节点，也会部署在我的节点上，你偷偷改了逻辑，我的节点不会认可你的，这也正是区块链的作用之一。")]),s._v(" "),n("p",[s._v("链码的功能定义在 "),n("code",[s._v("Invoke")]),s._v(" 方法中。")]),s._v(" "),n("p",[s._v("一个简易的示例如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package main\n\nimport (\n "encoding/json"\n "errors"\n "fmt"\n "strconv"\n\n "github.com/hyperledger/fabric/core/chaincode/shim"\n pb "github.com/hyperledger/fabric/protos/peer"\n)\n\ntype MyChaincode struct {\n}\n\n// Init 初始化时会执行该方法\nfunc (c *MyChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response {\n fmt.Println("链码初始化")\n // 假设A有1000元，以复合主键 userA 的形式写入账本\n err := WriteLedger(stub, map[string]interface{}{"name": "A", "balance": 1000}, "user", []string{"A"})\n if err != nil {\n  return shim.Error(err.Error())\n }\n // 假设B有1000元，以复合主键 userB 的形式写入账本\n err = WriteLedger(stub, map[string]interface{}{"name": "B", "balance": 1000}, "user", []string{"B"})\n if err != nil {\n  return shim.Error(err.Error())\n }\n return shim.Success(nil)\n}\n\n// Invoke 智能合约的功能函数定义\nfunc (c *MyChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response {\n funcName, args := stub.GetFunctionAndParameters()\n switch funcName {\n case "query":\n  return query(stub, args)\n case "transfer":\n  return transfer(stub, args)\n default:\n  return shim.Error(fmt.Sprintf("没有该功能: %s", funcName))\n }\n}\n\nfunc query(stub shim.ChaincodeStubInterface, args []string) pb.Response {\n // 如果 args 为空，则表示查询所有 user\n results, err := ReadLedger(stub, "user", args)\n if err != nil {\n  return shim.Error(err.Error())\n }\n var users []map[string]interface{}\n for _, result := range results {\n  var user map[string]interface{}\n  if err = json.Unmarshal(result, &user); err != nil {\n   return shim.Error(err.Error())\n  }\n  users = append(users, user)\n }\n usersByte, err := json.Marshal(&users)\n if err != nil {\n  return shim.Error(err.Error())\n }\n return shim.Success(usersByte)\n}\n\nfunc transfer(stub shim.ChaincodeStubInterface, args []string) pb.Response {\n // 验证参数\n if len(args) != 3 {\n  return shim.Error("参数个数不满足")\n }\n from := args[0]\n to := args[1]\n money, err := strconv.ParseFloat(args[2], 64)\n if err != nil {\n  return shim.Error(err.Error())\n }\n // 从账本查询 from 用户\n fromResults, err := ReadLedger(stub, "user", []string{from})\n if err != nil {\n  return shim.Error(err.Error())\n }\n if len(fromResults) != 1 {\n  return shim.Error("没有该用户 " + from)\n }\n var fromUser map[string]interface{}\n if err = json.Unmarshal(fromResults[0], &fromUser); err != nil {\n  return shim.Error(err.Error())\n }\n // 从账本查询 to 用户\n toResults, err := ReadLedger(stub, "user", []string{to})\n if err != nil {\n  return shim.Error(err.Error())\n }\n if len(toResults) != 1 {\n  return shim.Error("没有该用户 " + to)\n }\n var toUser map[string]interface{}\n if err = json.Unmarshal(toResults[0], &toUser); err != nil {\n  return shim.Error(err.Error())\n }\n // from 用户扣除余额\n if money > fromUser["balance"].(float64) {\n  return shim.Error("余额不足")\n }\n fromUser["balance"] = fromUser["balance"].(float64) - money\n // to 用户增加余额\n toUser["balance"] = toUser["balance"].(float64) + money\n // 写回账本\n err = WriteLedger(stub, fromUser, "user", []string{from})\n if err != nil {\n  return shim.Error(err.Error())\n }\n err = WriteLedger(stub, toUser, "user", []string{to})\n if err != nil {\n  return shim.Error(err.Error())\n }\n return shim.Success([]byte("ok"))\n}\n\nfunc main() {\n err := shim.Start(new(MyChaincode))\n if err != nil {\n  panic(err)\n }\n}\n\n// WriteLedger 写入账本\n// obj 为要写入的数据\n// objectType和keys 共同组成复合主键\nfunc WriteLedger(stub shim.ChaincodeStubInterface, obj interface{}, objectType string, keys []string) error {\n //创建复合主键\n var key string\n if val, err := stub.CreateCompositeKey(objectType, keys); err != nil {\n  return errors.New(fmt.Sprintf("%s-创建复合主键出错 %s", objectType, err.Error()))\n } else {\n  key = val\n }\n bytes, err := json.Marshal(obj)\n if err != nil {\n  return err\n }\n //写入区块链账本\n if err := stub.PutState(key, bytes); err != nil {\n  return errors.New(fmt.Sprintf("%s-写入区块链账本出错: %s", objectType, err.Error()))\n }\n return nil\n}\n\n// ReadLedger 根据复合主键查询账本数据(适合获取全部或指定的数据)\n// objectType和keys 共同组成复合主键\nfunc ReadLedger(stub shim.ChaincodeStubInterface, objectType string, keys []string) (results [][]byte, err error) {\n // 通过主键从区块链查找相关的数据，相当于对主键的模糊查询\n resultIterator, err := stub.GetStateByPartialCompositeKey(objectType, keys)\n if err != nil {\n  return nil, errors.New(fmt.Sprintf("%s-获取全部数据出错: %s", objectType, err))\n }\n defer resultIterator.Close()\n\n //检查返回的数据是否为空，不为空则遍历数据，否则返回空数组\n for resultIterator.HasNext() {\n  val, err := resultIterator.Next()\n  if err != nil {\n   return nil, errors.New(fmt.Sprintf("%s-返回的数据出错: %s", objectType, err))\n  }\n\n  results = append(results, val.GetValue())\n }\n return results, nil\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br")])]),n("p",[s._v("在这段链码中，初始化的时候我们假设有用户 "),n("code",[s._v("A")]),s._v(" 和 "),n("code",[s._v("B")]),s._v(" ，并且都各自有 "),n("code",[s._v("1000")]),s._v(" 元余额，我们在 "),n("code",[s._v("Invoke")]),s._v(" 方法中为其定义了两个功能函数 "),n("code",[s._v("query")]),s._v(" 和 "),n("code",[s._v("transfer")]),s._v(" 。 其中 "),n("code",[s._v("query")]),s._v(" 函数可以查询 "),n("code",[s._v("A")]),s._v(" 和 "),n("code",[s._v("B")]),s._v(" 或指定用户的余额信息， "),n("code",[s._v("transfer")]),s._v(" 函数可以通过传入转账人，被转账人，金额，三个参数来实现转账功能。例如 "),n("code",[s._v('{"Args":["transfer","A","B","100.0"]}')]),s._v(" 代表 "),n("code",[s._v("A")]),s._v(" 向 "),n("code",[s._v("B")]),s._v(" 转账 "),n("code",[s._v("100")]),s._v(" 元。")]),s._v(" "),n("h3",{attrs:{id:"部署链码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署链码"}},[s._v("#")]),s._v(" 部署链码")]),s._v(" "),n("p",[s._v("我们将刚刚编写的智能合约也就是链码安装到区块链网络中，同样是借助 "),n("code",[s._v("cli")]),s._v(" 服务，我们在 "),n("code",[s._v("Taobao")]),s._v(" 组织的 "),n("code",[s._v("peer0")]),s._v(" 节点和 "),n("code",[s._v("JD")]),s._v(" 组织的 "),n("code",[s._v("peer0")]),s._v(" 节点上都安装上链码：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker exec cli bash -c "$TaobaoPeer0Cli peer chaincode install -n fabric-realty -v 1.0.0 -l golang -p chaincode"\n$ docker exec cli bash -c "$JDPeer0Cli peer chaincode install -n fabric-realty -v 1.0.0 -l golang -p chaincode"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("其中 "),n("code",[s._v("-n")]),s._v(" 参数是链码名称，可以自己随便设置，"),n("code",[s._v("-v")]),s._v(" 是链码版本号，"),n("code",[s._v("-p")]),s._v(" 是链码的目录（我们已经将链码挂载到 "),n("code",[s._v("cli")]),s._v(" 容器中了，在 "),n("code",[s._v("/opt/gopath/src/")]),s._v(" 目录下）")]),s._v(" "),n("p",[s._v("链码安装后，还需要实例化后才可以使用，只需要在任意一个节点实例化就可以了，以 "),n("code",[s._v("Taobao")]),s._v(" 组织的 "),n("code",[s._v("peer0")]),s._v(" 节点为例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker exec cli bash -c "$TaobaoPeer0Cli peer chaincode instantiate -o orderer.qq.com:7050 -C appchannel -n fabric-realty -l golang -v 1.0.0 -c \'{\\"Args\\":[\\"init\\"]}\' -P \\"AND (\'TaobaoMSP.member\',\'JDMSP.member\')\\""\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("实例化链码主要就是传入 "),n("code",[s._v('{"Args":["init"]}')]),s._v(" 参数，此时会调用我们编写的 "),n("code",[s._v("func (c *MyChaincode) Init")]),s._v(" 方法，进行链码的初始化。其中 "),n("code",[s._v("-P")]),s._v(" 参数用于指定链码的背书策略，"),n("code",[s._v("AND ('TaobaoMSP.member','JDMSP.member')")]),s._v(" 代表链码的写入操作需要同时得到 "),n("code",[s._v("Taobao")]),s._v("和 "),n("code",[s._v("JD")]),s._v(" 组织成员的背书才允许通过。"),n("code",[s._v("AND")]),s._v(" 也可以替换成 "),n("code",[s._v("OR")]),s._v("，代表任意一组织成员背书即可，更多具体用法，可以去看官方文档。")]),s._v(" "),n("p",[s._v("链码实例化成功之后就会启动链码容器，而启动的方法，就是我们之前提过的 peer 节点服务挂载了 "),n("code",[s._v("/var/run/docker.sock")]),s._v(" 文件。")]),s._v(" "),n("p",[s._v("查看启动的链码容器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ docker ps -a | awk '($2 ~ /dev-peer.*fabric-realty.*/) {print $2}'\ndev-peer0.taobao.com-fabric-realty-1.0.0-4f127a0415dd835529133a69b480ce24581dd5ddcaf18426ecc1d3dfb02b4670\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("因为我们使用 "),n("code",[s._v("Taobao")]),s._v(" 组织的 "),n("code",[s._v("peer0")]),s._v(" 节点实例化链码，所以此时还只有这个节点的链码容器启动起来了。")]),s._v(" "),n("p",[s._v("我们可以试着使用 "),n("code",[s._v("cli")]),s._v(" 服务去调用链码：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker exec cli bash -c "$TaobaoPeer0Cli peer chaincode invoke -C appchannel -n fabric-realty -c \'{\\"Args\\":[\\"query\\"]}\'"\n2022-03-22 21:13:40.152 UTC [chaincodeCmd] InitCmdFactory -> INFO 001 Retrieved channel (appchannel) orderer endpoint: orderer.qq.com:7050\n2022-03-22 21:13:40.157 UTC [chaincodeCmd] chaincodeInvokeOrQuery -> INFO 002 Chaincode invoke successful. result: status:200 payload:"[{\\\n"balance\\":1000,\\"name\\":\\"A\\"},{\\"balance\\":1000,\\"name\\":\\"B\\"}]"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("当然，使用"),n("code",[s._v("JD")]),s._v("组织的节点也是可以的：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker exec cli bash -c "$JDPeer0Cli peer chaincode invoke -C appchannel -n fabric-realty -c \'{\\"Args\\":[\\"query\\"]}\'"\n2022-03-22 21:14:45.397 UTC [chaincodeCmd] InitCmdFactory -> INFO 001 Retrieved channel (appchannel) orderer endpoint: orderer.qq.com:7050\n2022-03-22 21:14:45.402 UTC [chaincodeCmd] chaincodeInvokeOrQuery -> INFO 002 Chaincode invoke successful. result: status:200 payload:"[{\\\n"balance\\":1000,\\"name\\":\\"A\\"},{\\"balance\\":1000,\\"name\\":\\"B\\"}]"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("此时，因为我们查询了 "),n("code",[s._v("JD")]),s._v(" 组织的 "),n("code",[s._v("peer0")]),s._v(" 节点上的链码，所以对应的链码容器也会启动起来了，再次查看启动的链码容器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ docker ps -a | awk '($2 ~ /dev-peer.*fabric-realty.*/) {print $2}'\ndev-peer0.jd.com-fabric-realty-1.0.0-5c5e915cdcd47324151383f9619a0ff9a33283d969555e6029aa256cc389ebc9\ndev-peer0.taobao.com-fabric-realty-1.0.0-4f127a0415dd835529133a69b480ce24581dd5ddcaf18426ecc1d3dfb02b4670\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("现在，我们的智能合约就成功部署到区块链网络的通道中了。")]),s._v(" "),n("h3",{attrs:{id:"编写应用程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编写应用程序"}},[s._v("#")]),s._v(" 编写应用程序")]),s._v(" "),n("p",[s._v("在部署链码之后，我们是使用 "),n("code",[s._v("cli")]),s._v(" 服务去调用的，但这种方式一般只是作为验证使用，更多情况下，应该是我们自己编写应用程序集成 fabric 提供的 "),n("code",[s._v("SDK")]),s._v(" 去调用。")]),s._v(" "),n("p",[s._v("Go 语言可以使用官方的 "),n("code",[s._v("github.com/hyperledger/fabric-sdk-go")]),s._v(" 库。")]),s._v(" "),n("p",[s._v("这个 SDK 使用起来也很简单。")]),s._v(" "),n("p",[s._v("第一步调用其 "),n("code",[s._v("New")]),s._v(" 方法创建一个 "),n("code",[s._v("FabricSDK")]),s._v(" 实例，后续使用这个实例就可以调用操作合约的方法了。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// New 根据提供的一组选项初始化 SDK\n// ConfigOptions 提供应用程序配置\nfunc New(configProvider core.ConfigProvider, opts ...Option) (*FabricSDK, error) {\n pkgSuite := defPkgSuite{}\n return fromPkgSuite(configProvider, &pkgSuite, opts...)\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("其中 "),n("code",[s._v("configProvider")]),s._v(" 可以从 "),n("code",[s._v("Reader")]),s._v("(实现了"),n("code",[s._v("io.Reader")]),s._v("接口的实例) 、 "),n("code",[s._v("File")]),s._v("(文件) 或 "),n("code",[s._v("Raw")]),s._v("("),n("code",[s._v("[]byte")]),s._v(") 获取。我们选择最简单的文件方式。")]),s._v(" "),n("p",[s._v("创建一个 "),n("code",[s._v("config.yaml")]),s._v(" ，配置如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('version: 1.0.0\n\n# GO SDK 客户端配置\nclient:\n  # 客户端所属的组织，必须是organizations定义的组织\n  organization: JD\n  # 日志级别\n  logging:\n    level: info\n  # MSP证书的根路径\n  cryptoconfig:\n    path: /network/crypto-config\n\n# 通道定义\nchannels:\n  appchannel:\n    orderers:\n      - orderer.qq.com\n    peers:\n      peer0.jd.com:\n        endorsingPeer: true\n        chaincodeQuery: true\n        ledgerQuery: true\n        eventSource: true\n      peer1.jd.com:\n        endorsingPeer: true\n        chaincodeQuery: true\n        ledgerQuery: true\n        eventSource: true\n\n# 组织配置\norganizations:\n  JD:\n    mspid: "JDMSP"\n    cryptoPath: peerOrganizations/jd.com/users/{username}@jd.com/msp\n    peers:\n      - peer0.jd.com\n      - peer1.jd.com\n\n# orderer节点列表\norderers:\n  orderer.qq.com:\n    url: orderer.qq.com:7050\n    # 传递给gRPC客户端构造函数\n    grpcOptions:\n      ssl-target-name-override: orderer.qq.com\n      keep-alive-time: 0s\n      keep-alive-timeout: 20s\n      keep-alive-permit: false\n      fail-fast: false\n      allow-insecure: true\n\n# peers节点列表\npeers:\n  # peer节点定义，可以定义多个\n  peer0.jd.com:\n    # URL用于发送背书和查询请求\n    url: peer0.jd.com:7051\n    # 传递给gRPC客户端构造函数\n    grpcOptions:\n      ssl-target-name-override: peer0.jd.com\n      keep-alive-time: 0s\n      keep-alive-timeout: 20s\n      keep-alive-permit: false\n      fail-fast: false\n      allow-insecure: true\n  peer1.jd.com:\n    url: peer1.jd.com:7051\n    grpcOptions:\n      ssl-target-name-override: peer1.jd.com\n      keep-alive-time: 0s\n      keep-alive-timeout: 20s\n      keep-alive-permit: false\n      fail-fast: false\n      allow-insecure: true\n  peer0.taobao.com:\n    url: peer0.taobao.com:7051\n    grpcOptions:\n      ssl-target-name-override: peer0.taobao.com\n      keep-alive-time: 0s\n      keep-alive-timeout: 20s\n      keep-alive-permit: false\n      fail-fast: false\n      allow-insecure: true\n  peer1.taobao.com:\n    url: peer1.taobao.com:7051\n    grpcOptions:\n      ssl-target-name-override: peer1.taobao.com\n      keep-alive-time: 0s\n      keep-alive-timeout: 20s\n      keep-alive-permit: false\n      fail-fast: false\n      allow-insecure: true\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br")])]),n("p",[s._v("我们假定是 "),n("code",[s._v("JD")]),s._v(" 组织来编写这个应用程序，该配置主要就是用于验证 "),n("code",[s._v("JD")]),s._v(" 组织及其节点的身份。")]),s._v(" "),n("p",[s._v("其中组织配置中 "),n("code",[s._v("{username}")]),s._v(" 为动态传递， MSP 证书的根路径我们后续会挂载进去。")]),s._v(" "),n("p",[s._v("现在开始编写代码，我们先来实例化 SDK ，创建 "),n("code",[s._v("sdk.go")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package main\n\nimport (\n "github.com/hyperledger/fabric-sdk-go/pkg/client/channel"\n "github.com/hyperledger/fabric-sdk-go/pkg/core/config"\n "github.com/hyperledger/fabric-sdk-go/pkg/fabsdk"\n)\n\n// 配置信息\nvar (\n sdk           *fabsdk.FabricSDK                              // Fabric SDK\n channelName   = "appchannel"                                 // 通道名称\n username      = "Admin"                                      // 用户\n chainCodeName = "fabric-realty"                              // 链码名称\n endpoints     = []string{"peer0.jd.com", "peer0.taobao.com"} // 要发送交易的节点\n)\n\n// init 初始化\nfunc init() {\n var err error\n // 通过配置文件初始化SDK\n sdk, err = fabsdk.New(config.FromFile("config.yaml"))\n if err != nil {\n  panic(err)\n }\n}\n\n// ChannelExecute 区块链交互\nfunc ChannelExecute(fcn string, args [][]byte) (channel.Response, error) {\n // 创建客户端，表明在通道的身份\n ctx := sdk.ChannelContext(channelName, fabsdk.WithUser(username))\n cli, err := channel.New(ctx)\n if err != nil {\n  return channel.Response{}, err\n }\n // 对区块链账本的写操作（调用了链码的invoke）\n resp, err := cli.Execute(channel.Request{\n  ChaincodeID: chainCodeName,\n  Fcn:         fcn,\n  Args:        args,\n }, channel.WithTargetEndpoints(endpoints...))\n if err != nil {\n  return channel.Response{}, err\n }\n //返回链码执行后的结果\n return resp, nil\n}\n\n// ChannelQuery 区块链查询\nfunc ChannelQuery(fcn string, args [][]byte) (channel.Response, error) {\n // 创建客户端，表明在通道的身份\n ctx := sdk.ChannelContext(channelName, fabsdk.WithUser(username))\n cli, err := channel.New(ctx)\n if err != nil {\n  return channel.Response{}, err\n }\n // 对区块链账本查询的操作（调用了链码的invoke），只返回结果\n resp, err := cli.Query(channel.Request{\n  ChaincodeID: chainCodeName,\n  Fcn:         fcn,\n  Args:        args,\n }, channel.WithTargetEndpoints(endpoints...))\n if err != nil {\n  return channel.Response{}, err\n }\n //返回链码执行后的结果\n return resp, nil\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br")])]),n("p",[s._v("在这段代码中，我们将使用 "),n("code",[s._v("Admin")]),s._v(" 的身份去调用合约，并将每次的交易同时发送给 "),n("code",[s._v("peer0.jd.com")]),s._v(" 和 "),n("code",[s._v("peer0.taobao.com")]),s._v(" 节点进行背书，这是因为我们在实例化链码的时候指定了背书策略为 "),n("code",[s._v("AND ('TaobaoMSP.member','JDMSP.member')")]),s._v(" ，代表交易需要同时得到 "),n("code",[s._v("Taobao")]),s._v("和 "),n("code",[s._v("JD")]),s._v(" 组织成员的背书才允许通过。每次写入账本时，会验证这两个节点的数据一致性，只有当这两个节点的数据一致时，交易才算最终成功。")]),s._v(" "),n("p",[s._v("继续编写 "),n("code",[s._v("main.go")]),s._v(" ，我们使用 "),n("code",[s._v("gin")]),s._v(" 来创建一个 http 服务：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package main\n\nimport (\n "bytes"\n "encoding/json"\n\n "github.com/gin-gonic/gin"\n)\n\nfunc main() {\n g := gin.Default()\n g.GET("/query", func(c *gin.Context) {\n  args := make([][]byte, 0)\n  user := c.Query("user")\n  if user != "" {\n   args = append(args, []byte(user))\n  }\n  // 调用链码的query函数\n  resp, err := ChannelQuery("query", args)\n  if err != nil {\n   c.AbortWithStatusJSON(500, gin.H{"err": err.Error()})\n   return\n  }\n  var data []map[string]interface{}\n  if err = json.Unmarshal(bytes.NewBuffer(resp.Payload).Bytes(), &data); err != nil {\n   c.AbortWithStatusJSON(500, gin.H{"err": err.Error()})\n   return\n  }\n  c.JSON(200, data)\n })\n g.POST("/transfer", func(c *gin.Context) {\n  from := c.Query("from")\n  to := c.Query("to")\n  money := c.Query("money")\n  if from == "" || to == "" || money == "" {\n   c.AbortWithStatusJSON(400, gin.H{"err": "参数不能为空"})\n   return\n  }\n  args := make([][]byte, 0)\n  args = append(args, []byte(from), []byte(to), []byte(money))\n  // 调用链码的transfer函数\n  resp, err := ChannelExecute("transfer", args)\n  if err != nil {\n   c.AbortWithStatusJSON(500, gin.H{"err": err.Error()})\n   return\n  }\n  c.JSON(200, gin.H{"msg": string(resp.Payload)})\n })\n g.Run("0.0.0.0:8000")\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br")])]),n("p",[s._v("在 "),n("code",[s._v("main")]),s._v(" 函数中，我们创建了两个接口 "),n("code",[s._v("GET /query")]),s._v(" 和 "),n("code",[s._v("POST /transfer")]),s._v(" ，其中 "),n("code",[s._v("/query")]),s._v(" 接口调用链码的 "),n("code",[s._v("query")]),s._v(" 函数功能实现查询用户余额，"),n("code",[s._v("/transfer")]),s._v(" 接口调用链码的 "),n("code",[s._v("transfer")]),s._v(" 函数功能实现转账功能。")]),s._v(" "),n("p",[s._v("我们将继续使用 Docker 部署该应用程序，这样的好处是可以和区块链网络处于同一网络下，方便调用节点，当然你也可以更改 "),n("code",[s._v("config.yaml")]),s._v(" 文件去调用暴露在宿主机的节点端口也是可以的，首先编写 "),n("code",[s._v("Dockerfile")]),s._v(" 文件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('FROM golang:1.14 AS app\nENV GO111MODULE=on\nENV GOPROXY https://goproxy.cn,direct\nWORKDIR /root/togettoyou\nCOPY . .\nRUN CGO_ENABLED=0 go build -v -o "app" .\n\nFROM scratch\nWORKDIR /root/togettoyou/\nCOPY --from=app /root/togettoyou/app ./\nCOPY --from=app /root/togettoyou/config.yaml ./\nENTRYPOINT ["./app"]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("code",[s._v("docker-compose.yml")]),s._v(" 文件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '2.1'\n\nnetworks:\n  fabric_network:\n    external:\n      name: fabric_network\n\nservices:\n  app:\n    build: .\n    image: app:latest\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - ./../network/crypto-config:/network/crypto-config # 挂载搭建区块链网络时生成的crypto-config文件夹\n    networks:\n      - fabric_network\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("其中挂载的 "),n("code",[s._v("crypto-config")]),s._v(" 文件夹就是之前搭建区块链网络时生成的。")]),s._v(" "),n("p",[s._v("编译部署应用程序：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ docker-compose build\n$ docker-compose up\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("调用应用程序的接口：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ curl "http://localhost:8000/query"\n[{"balance":1000,"name":"A"},{"balance":1000,"name":"B"}]\n\n$ curl "http://localhost:8000/query?user=A"\n[{"balance":1000,"name":"A"}]\n\n$ curl "http://localhost:8000/query?user=B"\n[{"balance":1000,"name":"B"}]\n\n$ curl -X POST "http://localhost:8000/transfer?from=A&to=B&money=500"\n{"msg":"ok"}\n\n$ curl "http://localhost:8000/query"\n[{"balance":500,"name":"A"},{"balance":1500,"name":"B"}]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("到这里，我们就已经完整地实现了一个区块链应用了。你也可以继续为这个区块链应用实现前端页面。流程呢，和传统前后端分离架构也没什么区别。")])])}),[],!1,null,null,null);n.default=r.exports}}]);